<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Webhook Viewer</title>
<style>
  body { background: #0d0d0d; color: #00ffcc; font-family: monospace; padding: 20px; }
  pre { background: #111; padding: 15px; border-radius: 8px; overflow-x: auto; }
  button, select { padding: 8px 12px; margin: 5px; cursor: pointer; }
</style>
</head>
<body>

<h2>Webhook Logs</h2>

<button onclick="load()">Refresh</button>
<select id="logSelect"></select>
<button onclick="deleteSelected()">Delete Selected</button>
<button onclick="deleteAll()">Delete All</button>

<div id="logs"></div>

<script>
let logs = [];

async function load() {
  const res = await fetch("/.netlify/functions/webhook");
  logs = await res.json();

  const logsContainer = document.getElementById("logs");
  logsContainer.innerHTML = logs.map(l => `<pre>ID: ${l.id}\nTime: ${l.time}\nData: ${JSON.stringify(l.data, null, 2)}</pre>`).join("");

  const select = document.getElementById("logSelect");
  select.innerHTML = logs.map(l => `<option value="${l.id}">ID: ${l.id} | ${l.time}</option>`).join("");
}

async function deleteSelected() {
  const select = document.getElementById("logSelect");
  const id = select.value;
  if (!id) return alert("No log selected");

  await fetch(`/.netlify/functions/webhook?id=${id}`, { method: "DELETE" });
  load();
}

async function deleteAll() {
  if (!confirm("Delete all logs?")) return;
  await fetch(`/.netlify/functions/webhook?id=all`, { method: "DELETE" });
  load();
}

load();
</script>

</body>
</html>